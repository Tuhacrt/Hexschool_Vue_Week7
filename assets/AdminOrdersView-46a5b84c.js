import{e as T,t as I,f as x,g as R,M as A,o as d,c as i,a as t,u as n,h as l,i as D,F as k,m as M,j as P,E as U,l as S,r as j,b as g,n as $,A as w}from"./index-426a3836.js";import{_ as B}from"./DeleteModal.vue_vue_type_script_setup_true_lang-e3d6da44.js";import{f as L}from"./index-df2f2ebb.js";import{_ as N}from"./PaginationComponent.vue_vue_type_style_index_0_lang-eb5f62f5.js";const H={class:"modal-dialog modal-xl",role:"document"},q={class:"modal-content border-0"},F=t("div",{class:"modal-header bg-dark text-white"},[t("h5",{id:"exampleModalLabel",class:"modal-title"},[t("span",null,"訂單細節")]),t("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"modal","aria-label":"Close"})],-1),K={class:"modal-body"},W={class:"row"},X={class:"col-md-4"},z=t("h3",null,"用戶資料",-1),G={class:"table"},J={key:0},Q=t("th",{style:{width:"100px"}},"姓名",-1),Y=t("th",null,"Email",-1),Z=t("th",null,"電話",-1),tt=t("th",null,"地址",-1),et={class:"col-md-8"},st=t("h3",null,"訂單細節",-1),ot={class:"table"},at=t("th",{style:{width:"100px"}},"訂單編號",-1),nt=t("th",null,"下單時間",-1),lt=t("th",null,"付款時間",-1),dt={key:0},it={key:1},ct=t("th",null,"付款狀態",-1),rt={key:0,class:"text-success"},_t={key:1,class:"text-muted"},ut=t("th",null,"總金額",-1),pt=t("h3",null,"選購商品",-1),ht={class:"table"},mt=t("thead",null,[t("tr")],-1),ft={class:"text-end"},bt={class:"d-flex justify-content-end"},yt={class:"form-check"},gt={class:"form-check-label",for:"flexCheckDefault"},kt={key:0},vt={key:1},$t={class:"modal-footer"},wt=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1),xt=T({__name:"OrderModal",props:{tempOrder:null,isPaid:{type:Boolean}},emits:["update-paid"],setup(O,{expose:m,emit:b}){const o=I(O,"tempOrder"),h=x("");let u;return R(()=>{u=new A(h.value,{keyboard:!1,backdrop:!1})}),m({showModal:()=>u==null?void 0:u.show(),hideModal:()=>u==null?void 0:u.hide()}),(y,r)=>{var c,_,a;return d(),i("div",{id:"orderModal",ref_key:"orderModalRef",ref:h,class:"modal fade",tabindex:"-1",role:"dialog","aria-labelledby":"orderModalLabel","aria-hidden":"true"},[t("div",H,[t("div",q,[F,t("div",K,[t("div",W,[t("div",X,[z,t("table",G,[n(o).user?(d(),i("tbody",J,[t("tr",null,[Q,t("td",null,l(n(o).user.name),1)]),t("tr",null,[Y,t("td",null,l(n(o).user.email),1)]),t("tr",null,[Z,t("td",null,l(n(o).user.tel),1)]),t("tr",null,[tt,t("td",null,l(n(o).user.address),1)])])):D("",!0)])]),t("div",et,[st,t("table",ot,[t("tbody",null,[t("tr",null,[at,t("td",null,l(n(o).id),1)]),t("tr",null,[nt,t("td",null,l(n(L)((c=n(o))==null?void 0:c.create_at)),1)]),t("tr",null,[lt,t("td",null,[(_=n(o))!=null&&_.paid_date?(d(),i("span",dt,l(n(L)((a=n(o))==null?void 0:a.paid_date)),1)):(d(),i("span",it,"尚未付款"))])]),t("tr",null,[ct,t("td",null,[n(o).is_paid?(d(),i("strong",rt,"已付款")):(d(),i("span",_t,"尚未付款"))])]),t("tr",null,[ut,t("td",null,l(n(o).total),1)])])]),pt,t("table",ht,[mt,t("tbody",null,[(d(!0),i(k,null,M(n(o).products,e=>(d(),i("tr",{key:e.id},[t("th",null,l(e.product.title),1),t("td",null,l(e.qty)+" / "+l(e.product.unit),1),t("td",ft,l(e.final_total),1)]))),128))])]),t("div",bt,[t("div",yt,[P(t("input",{id:"flexCheckDefault","onUpdate:modelValue":r[0]||(r[0]=e=>n(o).is_paid=e),class:"form-check-input",type:"checkbox",value:""},null,512),[[U,n(o).is_paid]]),t("label",gt,[n(o).is_paid?(d(),i("span",kt,"已付款")):(d(),i("span",vt,"未付款"))])])])])])]),t("div",$t,[wt,t("button",{type:"button",class:"btn btn-primary",onClick:r[1]||(r[1]=e=>y.$emit("update-paid",n(o)))}," 修改付款狀態 ")])])])],512)}}}),Mt={class:"container"},Lt={class:"table mt-4"},Ot=t("thead",null,[t("tr",null,[t("th",{width:"130"},"購買時間"),t("th",{width:"130"},"會員信箱"),t("th",{width:"130"},"購買款項"),t("th",{width:"130"},"總額"),t("th",{width:"130"},"是否付款"),t("th",{width:"120"},"編輯")])],-1),Ct={key:0},Et={class:"text-end"},Vt={class:"form-check form-switch d-flex justify-content-center"},Tt=["id","onUpdate:modelValue","onChange"],Rt=["for"],Dt={key:0},Pt={key:1},Ut={class:"btn-group"},It=["onClick"],At=["onClick"],St={class:"d-flex justify-content-center"},qt=T({__name:"AdminOrdersView",setup(O){const{VITE_URL:m,VITE_PATH:b}={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"tuhacrt",VITE_TOKEN:"loginToken",VITE_TEXT:"Environment is in production build",BASE_URL:"/Hexschool_Vue_Week7/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},s=S({orders:[],tempOrder:{create_at:Date.now(),is_paid:!1},pagination:{},isLoading:!1,isPaid:!1,isNew:!1}),o=x(),h=x(),u=async(r=s.pagination.current_page||1)=>{var _;const c=`${m}/api/${b}/admin/orders/?page=${r}`;s.isLoading=!0;try{const a=await $.get(c);s.isLoading=!1,s.orders=a.data.orders,s.pagination=a.data.pagination}catch(a){s.isLoading=!1,a instanceof w&&alert((_=a.response)==null?void 0:_.data.message)}};R(()=>{u()});const v=async r=>{var a,e;const c=`${m}/api/${b}/admin/order/${r.id}`,_={...s.tempOrder,is_paid:r.is_paid,paid_date:r.is_paid?Math.floor(Date.now()/1e3):0};s.isLoading=!0;try{await $.put(c,{data:_}),(a=o.value)==null||a.hideModal(),u()}catch(f){s.isLoading=!1,f instanceof w&&alert((e=f.response)==null?void 0:e.data.message)}},C=async()=>{var c,_;const r=`${m}/api/${b}/admin/order/${s.tempOrder.id}`;s.isLoading=!0;try{await $.delete(r),(c=h.value)==null||c.hideModal(),u()}catch(a){s.isLoading=!1,a instanceof w&&alert((_=a.response)==null?void 0:_.data.message)}},y=(r,c)=>{var _,a;switch(r){case"edit":s.tempOrder={...c},s.isPaid=s.tempOrder.is_paid,(_=o.value)==null||_.showModal();break;case"delete":s.tempOrder={...c},(a=h.value)==null||a.showModal();break}};return(r,c)=>{var a;const _=j("Loading");return d(),i(k,null,[t("div",Mt,[t("table",Lt,[Ot,(a=s.orders)!=null&&a.length?(d(),i("tbody",Ct,[(d(!0),i(k,null,M(s.orders,e=>{var f;return d(),i("tr",{key:e.id},[t("td",null,l(n(L)(e==null?void 0:e.create_at)),1),t("td",null,l((f=e.user)==null?void 0:f.email),1),t("td",null,[(d(!0),i(k,null,M(e.products,p=>{var E,V;return d(),i("tr",{key:p.id,class:"d-flex justify-content-start"},[t("td",null,l((E=p.product)==null?void 0:E.title)+" "+l(p.qty)+" "+l((V=p.product)==null?void 0:V.unit),1)])}),128))]),t("td",Et,l(e.total),1),t("td",null,[t("div",Vt,[P(t("input",{id:`paidSwitch${e.id}`,"onUpdate:modelValue":p=>e.is_paid=p,type:"checkbox",class:"form-check-input me-2",onChange:p=>v(e)},null,40,Tt),[[U,e.is_paid]]),t("label",{class:"form-check-label",for:`paidSwitch${e.id}`},[e.is_paid?(d(),i("span",Dt,"已付款")):(d(),i("span",Pt,"未付款"))],8,Rt)])]),t("td",null,[t("div",Ut,[t("button",{class:"btn btn-outline-primary btn-sm",onClick:p=>y("edit",e)}," 檢視 ",8,It),t("button",{class:"btn btn-outline-danger btn-sm",onClick:p=>y("delete",e)}," 刪除 ",8,At)])])])}),128))])):D("",!0)]),t("div",St,[g(N,{ref:"paginationComponentRef",pagination:s.pagination,onChangePage:u},null,8,["pagination"])])]),g(xt,{ref_key:"orderModalRef",ref:o,"temp-order":s.tempOrder,"is-paid":s.tempOrder.is_paid,onUpdatePaid:c[0]||(c[0]=e=>v(s.tempOrder))},null,8,["temp-order","is-paid"]),g(B,{ref_key:"deleteModalRef",ref:h,"delete-item":s.tempOrder,onDeleteItem:C},null,8,["delete-item"]),g(_,{active:s.isLoading,"onUpdate:active":c[1]||(c[1]=e=>s.isLoading=e),"can-cancel":!0,"is-full-page":!0},null,8,["active"])],64)}}});export{qt as default};
