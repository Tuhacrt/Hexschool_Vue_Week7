import{e as T,t as U,f as k,g as E,M as N,o as f,c as h,a as e,j as _,v,u as d,D,l as I,r as A,F as V,m as B,i as P,b as y,h as b,n as w,A as $,x as S}from"./index-ffe0db42.js";import{_ as H}from"./DeleteModal.vue_vue_type_script_setup_true_lang-4aaa6229.js";import{_ as O}from"./PaginationComponent.vue_vue_type_style_index_0_lang-30623594.js";import{f as j}from"./index-a84c5b70.js";const F={class:"modal-dialog modal-xl",role:"document"},X={class:"modal-content bcoupon-0"},q=e("div",{class:"modal-header bg-dark text-white"},[e("h5",{id:"exampleModalLabel",class:"modal-title"},[e("span",null,"新增優惠券")]),e("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"modal","aria-label":"Close"})],-1),z={class:"modal-body"},K={class:"mb-3"},W=e("label",{for:"title"},"標題",-1),G={class:"mb-3"},J=e("label",{for:"coupon_code"},"優惠碼",-1),Q={class:"mb-3"},Y=e("label",{for:"due_date"},"到期日",-1),Z={class:"mb-3"},ee=e("label",{for:"price"},"折扣百分比",-1),te={class:"mb-3"},oe={class:"form-check"},se=e("label",{class:"form-check-label",for:"is_enabled"}," 是否啟用 ",-1),ne={class:"modal-footer"},ae=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1),le=T({__name:"CouponModal",props:{tempCoupon:null},emits:["update-coupon"],setup(M,{expose:p,emit:g}){const t=U(M,"tempCoupon"),u=k("");let r;return E(()=>{r=new N(u.value,{keyboard:!1,backdrop:!1})}),p({showModal:()=>r==null?void 0:r.show(),hideModal:()=>r==null?void 0:r.hide()}),(C,a)=>(f(),h("div",{id:"couponModal",ref_key:"couponModalRef",ref:u,class:"modal fade",tabindex:"-1",role:"dialog","aria-labelledby":"couponModalLabel","aria-hidden":"true"},[e("div",F,[e("div",X,[q,e("div",z,[e("div",K,[W,_(e("input",{id:"title","onUpdate:modelValue":a[0]||(a[0]=l=>d(t).title=l),type:"text",class:"form-control",placeholder:"請輸入標題"},null,512),[[v,d(t).title]])]),e("div",G,[J,_(e("input",{id:"coupon_code","onUpdate:modelValue":a[1]||(a[1]=l=>d(t).code=l),type:"text",class:"form-control",placeholder:"請輸入優惠碼"},null,512),[[v,d(t).code]])]),e("div",Q,[Y,_(e("input",{id:"due_date","onUpdate:modelValue":a[2]||(a[2]=l=>d(t).due_date=l),type:"date",class:"form-control"},null,512),[[v,d(t).due_date]])]),e("div",Z,[ee,_(e("input",{id:"price","onUpdate:modelValue":a[3]||(a[3]=l=>d(t).percent=l),type:"number",class:"form-control",min:"0",placeholder:"請輸入折扣百分比"},null,512),[[v,d(t).percent,void 0,{number:!0}]])]),e("div",te,[e("div",oe,[_(e("input",{id:"is_enabled","onUpdate:modelValue":a[4]||(a[4]=l=>d(t).is_enabled=l),class:"form-check-input",type:"checkbox","true-value":1,"false-value":0},null,512),[[D,d(t).is_enabled]]),se])])]),e("div",ne,[ae,e("button",{type:"button",class:"btn btn-primary",onClick:a[5]||(a[5]=l=>C.$emit("update-coupon",d(t)))}," 修改付款狀態 ")])])])],512))}}),ie={class:"container"},de={class:"text-end mt-4"},ce={class:"table mt-4"},re=e("thead",null,[e("tr",null,[e("th",{width:"120"},"名稱"),e("th",null,"折扣百分比"),e("th",{width:"120"},"到期日"),e("th",{width:"100"},"是否啟用"),e("th",{width:"120"},"編輯")])],-1),ue={key:0},pe={class:"text-end"},me={class:"btn-group"},_e=["onClick"],be=["onClick"],fe={class:"d-flex justify-content-center"},he={class:"text-center"},we=T({__name:"AdminCouponsView",setup(M){const{VITE_URL:p,VITE_PATH:g,VITE_TEXT:x}={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"tuhacrt",VITE_TOKEN:"loginToken",VITE_TEXT:"Environment is in production build",BASE_URL:"/Hexschool_Vue_Week7/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},t=I({coupons:[],pagination:{},tempCoupon:{},isNew:!1,isLoading:!1}),u=k(),r=k(),m=async(c=t.pagination.current_page||1)=>{var i;const s=`${p}/api/${g}/admin/coupons/?page=${c}`;t.isLoading=!0;try{const n=await w.get(s);t.isLoading=!1,t.coupons=n.data.coupons,t.pagination=n.data.pagination}catch(n){t.isLoading=!1,n instanceof $&&alert((i=n.response)==null?void 0:i.data.message)}};E(()=>{m()});const L=()=>{const c=`${p}/api/${g}/admin/coupon`,s=t.isNew?c:`${c}/${t.tempCoupon.id}`;return{method:t.isNew?"post":"put",url:s}},C=async()=>{var i,n;const{method:c,url:s}=L();console.log(c,s),t.isLoading=!0,console.log(t.tempCoupon);try{await w[c](s,{data:t.tempCoupon}),(i=u.value)==null||i.hideModal(),m()}catch(o){o instanceof $&&alert((n=o.response)==null?void 0:n.data.message)}},a=async()=>{var s,i;const c=`${p}/api/${g}/admin/coupon/${t.tempCoupon.id}`;t.isLoading=!0;try{await w.delete(c),(s=r.value)==null||s.hideModal(),m()}catch(n){t.isLoading=!1,n instanceof $&&alert((i=n.response)==null?void 0:i.data.message)}},l=(c,s={})=>{var i,n,o;switch(c){case"new":t.tempCoupon={},t.isNew=!0,(i=u.value)==null||i.showModal();break;case"edit":t.tempCoupon={...s},t.isNew=!1,(n=u.value)==null||n.showModal();break;case"delete":t.tempCoupon={...s},(o=r.value)==null||o.showModal();break}};return(c,s)=>{var n;const i=A("Loading");return f(),h(V,null,[e("div",ie,[e("div",de,[e("button",{class:"btn btn-primary",onClick:s[0]||(s[0]=o=>l("new"))}," 建立新的優惠券 ")]),e("table",ce,[re,(n=t.coupons)!=null&&n.length?(f(),h("tbody",ue,[(f(!0),h(V,null,B(t.coupons,o=>(f(),h("tr",{key:o.id},[e("td",null,b(o.title),1),e("td",null,b(o.percent),1),e("td",pe,b(d(j)(new Date(((o==null?void 0:o.due_date)||0)*1e3),"yyyy/MM/dd")),1),e("td",null,[e("span",{class:S({"text-success":o.is_enabled})},b(o.is_enabled?"啟用":"未啟用"),3)]),e("td",null,[e("div",me,[e("button",{class:"btn btn-outline-primary btn-sm",onClick:R=>l("edit",o)}," 編輯 ",8,_e),e("button",{class:"btn btn-outline-danger btn-sm",onClick:R=>l("delete",o)}," 刪除 ",8,be)])])]))),128))])):P("",!0)]),e("div",fe,[y(O,{ref:"paginationComponentRef",pagination:t.pagination,onChangePage:m},null,8,["pagination"])]),e("div",he,[e("p",null,b(d(x)),1)])]),y(le,{ref_key:"couponModalRef",ref:u,"temp-coupon":t.tempCoupon,"is-new":t.isNew,onUpdateCoupon:C},null,8,["temp-coupon","is-new"]),y(H,{ref_key:"deleteModalRef",ref:r,"delete-item":t.tempCoupon,onDeleteItem:a},null,8,["delete-item"]),y(i,{active:t.isLoading,"onUpdate:active":s[1]||(s[1]=o=>t.isLoading=o),"can-cancel":!0,"is-full-page":!0},null,8,["active"])],64)}}});export{we as default};
