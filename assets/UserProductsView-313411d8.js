import{e as T,f as w,g as x,M as E,t as V,o as c,c as r,a as t,h as u,u as l,i as M,j as P,v as U,k as R,l as I,r as A,F as C,m as D,b as k,n as $,A as L,p as S,q as B}from"./index-ffe0db42.js";import{_ as F}from"./PaginationComponent.vue_vue_type_style_index_0_lang-30623594.js";const N={class:"modal-dialog modal-xl",role:"document"},q={class:"modal-content border-0"},H={class:"modal-header bg-dark text-white"},O={id:"findMoreModalLabel",class:"modal-title"},j={class:"modal-body"},z={class:"row"},K={class:"col-sm-6"},W=["src"],X={class:"col-sm-6"},G={class:"badge bg-primary rounded-pill"},J={key:0,class:"h5"},Q={key:1},Y={class:"h6"},Z={class:"h5"},tt={class:"input-group"},et=T({__name:"FindMoreModal",props:{tempProduct:null,addToCart:{type:Function}},setup(v,{expose:g}){const h=v,e=w("");let d;x(()=>{d=new E(e==null?void 0:e.value,{keyboard:!1,backdrop:!1})});const a=V(h,"tempProduct");let p=1;const y=()=>{p=1,d==null||d.show()},b=()=>d==null?void 0:d.hide();return g({showModal:y,hideModal:b}),(_,n)=>{var i;return c(),r("div",{id:"findMoreModal",ref_key:"findMoreModalRef",ref:e,class:"modal fade",tabindex:"-1",role:"dialog","aria-labelledby":"findMoreModalLabel","aria-hidden":"true"},[t("div",N,[t("div",q,[t("div",H,[t("h5",O,[t("span",null,u(l(a).title),1)]),t("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"modal","aria-label":"Close",onClick:b})]),t("div",j,[t("div",z,[t("div",K,[l(a).imagesUrl?(c(),r("img",{key:0,class:"img-fluid",src:(i=l(a))==null?void 0:i.imagesUrl[0],alt:""},null,8,W)):M("",!0)]),t("div",X,[t("span",G,u(l(a).category),1),t("p",null,"商品描述："+u(l(a).description),1),t("p",null,"商品內容："+u(l(a).content),1),l(a).price<l(a).origin_price?(c(),r("div",J,u(l(a).origin_price)+" 元 ",1)):(c(),r("div",Q,[t("del",Y,"原價 "+u(l(a).origin_price)+" 元",1),t("div",Z,"現在只要 "+u(l(a).price)+" 元",1)])),t("div",null,[t("div",tt,[P(t("input",{"onUpdate:modelValue":n[0]||(n[0]=o=>R(p)?p.value=o:p=o),min:"1",type:"number",class:"form-control"},null,512),[[U,l(p),void 0,{number:!0}]]),t("button",{type:"button",class:"btn btn-primary",onClick:n[1]||(n[1]=o=>v.addToCart(l(a).id,l(p)))}," 加入購物車 ")])])])])])])])],512)}}}),st={class:"container"},ot={class:"mt-4"},nt={class:"table align-middle"},at=t("thead",null,[t("tr",null,[t("th",null,"圖片"),t("th",null,"商品名稱"),t("th",null,"價格"),t("th")])],-1),it={key:0},lt={style:{width:"200px"}},dt={key:0},ct={class:"h6"},rt={class:"h5"},ut={key:1,class:"h5"},_t={class:"btn-group btn-group-sm"},pt=["disabled","onClick"],gt=["disabled","onClick"],ht=["disabled","onClick"],mt={class:"d-flex justify-content-center"},vt=T({__name:"UserProductsView",setup(v){const{VITE_URL:g,VITE_PATH:h}={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"tuhacrt",VITE_TOKEN:"loginToken",VITE_TEXT:"Environment is in production build",BASE_URL:"/Hexschool_Vue_Week7/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},e=I({products:[],pagination:{},tempProduct:{imagesUrl:[]},isLoading:!1}),d=w(),a=async(_=e.pagination.current_page||1)=>{var i;const n=`${g}/api/${h}/products?page=${_}`;e.isLoading=!0;try{const o=await $.get(n);e.isLoading=!1,e.products=o.data.products,e.pagination=o.data.pagination}catch(o){o instanceof L&&alert((i=o.response)==null?void 0:i.data.message)}},p=async(_,n=1)=>{var s,m;const i=`${g}/api/${h}/cart`,o={product_id:_,qty:n};e.isLoading=!0;try{const f=await $.post(i,{data:o});e.isLoading=!1,(s=d.value)==null||s.hideModal(),alert(f.data.message)}catch(f){f instanceof L&&alert((m=f.response)==null?void 0:m.data.message)}};x(()=>{a()});const y=(_,n)=>{var i;switch(_){case"findMore":e.tempProduct={...n},(i=d.value)==null||i.showModal();break}},b=async _=>{var o;const{id:n}=_,i=`${g}/api/${h}/product/${n}`;e.tempProduct={..._},e.isLoading=!0;try{await $.get(i),e.isLoading=!1,B.push(`/product/${n}`)}catch(s){s instanceof L&&alert((o=s.response)==null?void 0:o.data.message)}};return(_,n)=>{var o;const i=A("Loading");return c(),r(C,null,[t("div",st,[t("div",ot,[t("table",nt,[at,(o=e.products)!=null&&o.length?(c(),r("tbody",it,[(c(!0),r(C,null,D(e==null?void 0:e.products,s=>(c(),r("tr",{key:s.id},[t("td",lt,[s.imagesUrl?(c(),r("div",{key:0,style:S([{height:"100px","background-size":"cover","background-position":"center"},{backgroundImage:`url(${s==null?void 0:s.imagesUrl[0]})`}])},null,4)):M("",!0)]),t("td",null,u(s.title),1),t("td",null,[s.price<s.origin_price?(c(),r("div",dt,[t("del",ct,"原價 "+u(s.origin_price)+" 元",1),t("div",rt,"現在只要 "+u(s.price)+" 元",1)])):(c(),r("div",ut,u(s.origin_price)+" 元",1))]),t("td",null,[t("div",_t,[t("button",{type:"button",class:"btn btn-outline-secondary",disabled:e.isLoading,onClick:m=>b(s)}," 詳細希望 ",8,pt),t("button",{type:"button",class:"btn btn-outline-secondary",disabled:e.isLoading,onClick:m=>y("findMore",s)}," 查看更多 ",8,gt),t("button",{type:"button",class:"btn btn-outline-danger",disabled:e.isLoading,onClick:m=>p(s.id)}," 加到購物車 ",8,ht)])])]))),128))])):M("",!0)])]),t("div",mt,[k(F,{ref:"paginationComponentRef",pagination:e.pagination,onChangePage:a},null,8,["pagination"])])]),k(et,{ref_key:"findMoreModalRef",ref:d,"temp-product":e.tempProduct,"add-to-cart":p},null,8,["temp-product"]),k(i,{active:e.isLoading,"onUpdate:active":n[0]||(n[0]=s=>e.isLoading=s),"can-cancel":!0,"is-full-page":!0},null,8,["active"])],64)}}});export{vt as default};
