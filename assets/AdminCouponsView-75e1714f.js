import{e as R,t as N,f as y,G as I,H as E,g as D,M as A,o as f,c as h,a as e,j as _,v as g,u as i,E as B,l as H,r as P,F as V,m as S,i as O,b as w,h as b,n as C,A as $,x as j}from"./index-a591a04d.js";import{f as k,a as F}from"./index-df2f2ebb.js";import{_ as X}from"./DeleteModal.vue_vue_type_script_setup_true_lang-84ecdae8.js";import{_ as q}from"./PaginationComponent.vue_vue_type_style_index_0_lang-81b17955.js";const z={class:"modal-dialog modal-xl",role:"document"},G={class:"modal-content bcoupon-0"},K=e("div",{class:"modal-header bg-dark text-white"},[e("h5",{id:"exampleModalLabel",class:"modal-title"},[e("span",null,"新增優惠券")]),e("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"modal","aria-label":"Close"})],-1),W={class:"modal-body"},J={class:"mb-3"},Q=e("label",{for:"title"},"標題",-1),Y={class:"mb-3"},Z=e("label",{for:"coupon_code"},"優惠碼",-1),ee={class:"mb-3"},te=e("label",{for:"due_date"},"到期日",-1),oe=["min"],se={class:"mb-3"},ae=e("label",{for:"price"},"折扣百分比",-1),ne={class:"mb-3"},le={class:"form-check"},ie=e("label",{class:"form-check-label",for:"is_enabled"}," 是否啟用 ",-1),de={class:"modal-footer"},ce=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1),re=R({__name:"CouponModal",props:{tempCoupon:null},emits:["update-coupon"],setup(M,{expose:p,emit:v}){const t=N(M,"tempCoupon"),r=y(""),c=y(""),u=I(()=>k(Date.now()/1e3,"-"));let d;return E(()=>{t.value.due_date=F(c.value)}),E(()=>{c.value=k(t.value.due_date||Date.now()/1e3,"-")}),D(()=>{d=new A(r.value,{keyboard:!1,backdrop:!1})}),p({showModal:()=>d==null?void 0:d.show(),hideModal:()=>d==null?void 0:d.hide()}),(m,s)=>(f(),h("div",{id:"couponModal",ref_key:"couponModalRef",ref:r,class:"modal fade",tabindex:"-1",role:"dialog","aria-labelledby":"couponModalLabel","aria-hidden":"true"},[e("div",z,[e("div",G,[K,e("div",W,[e("div",J,[Q,_(e("input",{id:"title","onUpdate:modelValue":s[0]||(s[0]=o=>i(t).title=o),type:"text",class:"form-control",placeholder:"請輸入標題"},null,512),[[g,i(t).title]])]),e("div",Y,[Z,_(e("input",{id:"coupon_code","onUpdate:modelValue":s[1]||(s[1]=o=>i(t).code=o),type:"text",class:"form-control",placeholder:"請輸入優惠碼"},null,512),[[g,i(t).code]])]),e("div",ee,[te,_(e("input",{id:"due_date","onUpdate:modelValue":s[2]||(s[2]=o=>c.value=o),min:i(u),type:"date",class:"form-control"},null,8,oe),[[g,c.value]])]),e("div",se,[ae,_(e("input",{id:"price","onUpdate:modelValue":s[3]||(s[3]=o=>i(t).percent=o),type:"number",class:"form-control",min:"0",placeholder:"請輸入折扣百分比"},null,512),[[g,i(t).percent,void 0,{number:!0}]])]),e("div",ne,[e("div",le,[_(e("input",{id:"is_enabled","onUpdate:modelValue":s[4]||(s[4]=o=>i(t).is_enabled=o),class:"form-check-input",type:"checkbox","true-value":1,"false-value":0},null,512),[[B,i(t).is_enabled]]),ie])])]),e("div",de,[ce,e("button",{type:"button",class:"btn btn-primary",onClick:s[5]||(s[5]=o=>m.$emit("update-coupon",i(t)))}," 修改付款狀態 ")])])])],512))}}),ue={class:"container"},pe={class:"text-end mt-4"},me={class:"table mt-4"},_e=e("thead",null,[e("tr",null,[e("th",{width:"120"},"名稱"),e("th",null,"折扣百分比"),e("th",{width:"120"},"到期日"),e("th",{width:"100"},"是否啟用"),e("th",{width:"120"},"編輯")])],-1),be={key:0},fe={class:"text-end"},he={class:"btn-group"},ve=["onClick"],ge=["onClick"],we={class:"d-flex justify-content-center"},ye={class:"text-center"},xe=R({__name:"AdminCouponsView",setup(M){const{VITE_URL:p,VITE_PATH:v,VITE_TEXT:x}={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"tuhacrt",VITE_TOKEN:"loginToken",VITE_TEXT:"Environment is in production build",BASE_URL:"/Hexschool_Vue_Week7/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},t=H({coupons:[],pagination:{},tempCoupon:{},isNew:!1,isLoading:!1}),r=y(),c=y(),u=async(s=t.pagination.current_page||1)=>{var l;const o=`${p}/api/${v}/admin/coupons/?page=${s}`;t.isLoading=!0;try{const n=await C.get(o);t.isLoading=!1,t.coupons=n.data.coupons,t.pagination=n.data.pagination}catch(n){t.isLoading=!1,n instanceof $&&alert((l=n.response)==null?void 0:l.data.message)}};D(()=>{u()});const d=()=>{const s=`${p}/api/${v}/admin/coupon`,o=t.isNew?s:`${s}/${t.tempCoupon.id}`;return{method:t.isNew?"post":"put",url:o}},T=async()=>{var l,n;const{method:s,url:o}=d();t.isLoading=!0;try{await C[s](o,{data:t.tempCoupon}),(l=r.value)==null||l.hideModal(),u()}catch(a){t.isLoading=!1,a instanceof $&&alert((n=a.response)==null?void 0:n.data.message)}},L=async()=>{var o,l;const s=`${p}/api/${v}/admin/coupon/${t.tempCoupon.id}`;t.isLoading=!0;try{await C.delete(s),(o=c.value)==null||o.hideModal(),u()}catch(n){t.isLoading=!1,n instanceof $&&alert((l=n.response)==null?void 0:l.data.message)}},m=(s,o={})=>{var l,n,a;switch(s){case"new":t.tempCoupon={is_enabled:0},t.isNew=!0,(l=r.value)==null||l.showModal();break;case"edit":t.tempCoupon={...o},t.isNew=!1,(n=r.value)==null||n.showModal();break;case"delete":t.tempCoupon={...o},(a=c.value)==null||a.showModal();break}};return(s,o)=>{var n;const l=P("Loading");return f(),h(V,null,[e("div",ue,[e("div",pe,[e("button",{class:"btn btn-primary",onClick:o[0]||(o[0]=a=>m("new"))}," 建立新的優惠券 ")]),e("table",me,[_e,(n=t.coupons)!=null&&n.length?(f(),h("tbody",be,[(f(!0),h(V,null,S(t.coupons,a=>(f(),h("tr",{key:a.id},[e("td",null,b(a.title),1),e("td",null,b(a.percent),1),e("td",fe,b(i(k)(a==null?void 0:a.due_date)),1),e("td",null,[e("span",{class:j({"text-success":a.is_enabled})},b(a.is_enabled?"啟用":"未啟用"),3)]),e("td",null,[e("div",he,[e("button",{class:"btn btn-outline-primary btn-sm",onClick:U=>m("edit",a)}," 編輯 ",8,ve),e("button",{class:"btn btn-outline-danger btn-sm",onClick:U=>m("delete",a)}," 刪除 ",8,ge)])])]))),128))])):O("",!0)]),e("div",we,[w(q,{ref:"paginationComponentRef",pagination:t.pagination,onChangePage:u},null,8,["pagination"])]),e("div",ye,[e("p",null,b(i(x)),1)])]),w(re,{ref_key:"couponModalRef",ref:r,"temp-coupon":t.tempCoupon,"is-new":t.isNew,onUpdateCoupon:T},null,8,["temp-coupon","is-new"]),w(X,{ref_key:"deleteModalRef",ref:c,"delete-item":t.tempCoupon,onDeleteItem:L},null,8,["delete-item"]),w(l,{active:t.isLoading,"onUpdate:active":o[1]||(o[1]=a=>t.isLoading=a),"can-cancel":!0,"is-full-page":!0},null,8,["active"])],64)}}});export{xe as default};
