import{e as T,t as E,f as x,o as l,c as r,a as t,g as c,u as a,h as L,i as V,v as w,j as R,k as P,l as U,r as I,F as C,m as A,b as $,n as k,A as M,p as D,q as S}from"./index-828dac57.js";import{u as B}from"./useModal-798cfd3b.js";import{_ as F}from"./PaginationComponent.vue_vue_type_style_index_0_lang-676d68d5.js";const N={class:"modal-dialog modal-xl",role:"document"},q={class:"modal-content border-0"},H={class:"modal-header bg-dark text-white"},O={id:"findMoreModalLabel",class:"modal-title"},j={class:"modal-body"},z={class:"row"},K={class:"col-sm-6"},Q=["src"],W={class:"col-sm-6"},X={class:"badge bg-primary rounded-pill"},G={key:0,class:"h5"},J={key:1},Y={class:"h6"},Z={class:"h5"},tt={class:"input-group"},et=T({__name:"FindMoreModal",props:{tempProduct:null,addToCart:{type:Function}},setup(v,{expose:p}){const e=E(v,"tempProduct"),_=x(""),{modal:y,showModal:b,hideModal:g}=B(_);let u=1;const d=()=>{u=1};return p({showModal:b,hideModal:g}),(i,s)=>{var n;return l(),r("div",{id:"findMoreModal",ref_key:"findMoreModalRef",ref:_,class:"modal fade",tabindex:"-1",role:"dialog","aria-labelledby":"findMoreModalLabel","aria-hidden":"true"},[t("div",N,[t("div",q,[t("div",H,[t("h5",O,[t("span",null,c(a(e).title),1)]),t("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"modal","aria-label":"Close",onClick:s[0]||(s[0]=(...o)=>a(g)&&a(g)(...o))})]),t("div",j,[t("div",z,[t("div",K,[a(e).imagesUrl?(l(),r("img",{key:0,class:"img-fluid",src:(n=a(e))==null?void 0:n.imagesUrl[0],alt:""},null,8,Q)):L("",!0)]),t("div",W,[t("span",X,c(a(e).category),1),t("p",null,"商品描述："+c(a(e).description),1),t("p",null,"商品內容："+c(a(e).content),1),a(e).price<a(e).origin_price?(l(),r("div",G,c(a(e).origin_price)+" 元 ",1)):(l(),r("div",J,[t("del",Y,"原價 "+c(a(e).origin_price)+" 元",1),t("div",Z,"現在只要 "+c(a(e).price)+" 元",1)])),t("div",null,[t("div",tt,[V(t("input",{"onUpdate:modelValue":s[1]||(s[1]=o=>R(u)?u.value=o:u=o),min:"1",type:"number",class:"form-control"},null,512),[[w,a(u),void 0,{number:!0}]]),t("button",{type:"button",class:"btn btn-primary",onClick:s[2]||(s[2]=o=>(v.addToCart(a(e).id,a(u)),d()))}," 加入購物車 ")])])])])])])])],512)}}}),ot={class:"container"},st={class:"mt-4"},nt={class:"table align-middle"},at=t("thead",null,[t("tr",null,[t("th",null,"圖片"),t("th",null,"商品名稱"),t("th",null,"價格"),t("th")])],-1),it={key:0},dt={style:{width:"200px"}},lt={key:0},rt={class:"h6"},ct={class:"h5"},ut={key:1,class:"h5"},_t={class:"btn-group btn-group-sm"},pt=["disabled","onClick"],gt=["disabled","onClick"],mt=["disabled","onClick"],ht={class:"d-flex justify-content-center"},yt=T({__name:"UserProductsView",setup(v){const{VITE_URL:p,VITE_PATH:h}={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"tuhacrt",VITE_TOKEN:"loginToken",VITE_TEXT:"Environment is in production build",BASE_URL:"/Hexschool_Vue_Week7/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},e=P({products:[],pagination:{},tempProduct:{imagesUrl:[]},isLoading:!1}),_=x(),y=async(d=e.pagination.current_page||1)=>{var s;const i=`${p}/api/${h}/products?page=${d}`;e.isLoading=!0;try{const n=await k.get(i);e.isLoading=!1,e.products=n.data.products,e.pagination=n.data.pagination}catch(n){n instanceof M&&alert((s=n.response)==null?void 0:s.data.message)}},b=async(d,i=1)=>{var o,m;const s=`${p}/api/${h}/cart`,n={product_id:d,qty:i};e.isLoading=!0;try{const f=await k.post(s,{data:n});e.isLoading=!1,(o=_.value)==null||o.hideModal(),alert(f.data.message)}catch(f){f instanceof M&&alert((m=f.response)==null?void 0:m.data.message)}};U(()=>{y()});const g=(d,i)=>{var s;switch(d){case"findMore":e.tempProduct={...i},(s=_.value)==null||s.showModal();break}},u=async d=>{var n;const{id:i}=d,s=`${p}/api/${h}/product/${i}`;e.tempProduct={...d},e.isLoading=!0;try{await k.get(s),e.isLoading=!1,S.push(`/product/${i}`)}catch(o){o instanceof M&&alert((n=o.response)==null?void 0:n.data.message)}};return(d,i)=>{var n;const s=I("Loading");return l(),r(C,null,[t("div",ot,[t("div",st,[t("table",nt,[at,(n=e.products)!=null&&n.length?(l(),r("tbody",it,[(l(!0),r(C,null,A(e==null?void 0:e.products,o=>(l(),r("tr",{key:o.id},[t("td",dt,[o.imagesUrl?(l(),r("div",{key:0,style:D([{height:"100px","background-size":"cover","background-position":"center"},{backgroundImage:`url(${o==null?void 0:o.imagesUrl[0]})`}])},null,4)):L("",!0)]),t("td",null,c(o.title),1),t("td",null,[o.price<o.origin_price?(l(),r("div",lt,[t("del",rt,"原價 "+c(o.origin_price)+" 元",1),t("div",ct,"現在只要 "+c(o.price)+" 元",1)])):(l(),r("div",ut,c(o.origin_price)+" 元",1))]),t("td",null,[t("div",_t,[t("button",{type:"button",class:"btn btn-outline-secondary",disabled:e.isLoading,onClick:m=>u(o)}," 詳細希望 ",8,pt),t("button",{type:"button",class:"btn btn-outline-secondary",disabled:e.isLoading,onClick:m=>g("findMore",o)}," 查看更多 ",8,gt),t("button",{type:"button",class:"btn btn-outline-danger",disabled:e.isLoading,onClick:m=>b(o.id)}," 加到購物車 ",8,mt)])])]))),128))])):L("",!0)])]),t("div",ht,[$(F,{ref:"paginationComponentRef",pagination:e.pagination,onChangePage:y},null,8,["pagination"])])]),$(et,{ref_key:"findMoreModalRef",ref:_,"temp-product":e.tempProduct,"add-to-cart":b},null,8,["temp-product"]),$(s,{active:e.isLoading,"onUpdate:active":i[0]||(i[0]=o=>e.isLoading=o),"can-cancel":!0,"is-full-page":!0},null,8,["active"])],64)}}});export{yt as default};
