import{e as D,t as I,f as M,g as R,M as A,o as d,c as i,a as t,u as n,h as l,i as T,F as k,m as x,j as P,D as U,l as S,r as j,b as g,n as $,A as w}from"./index-ffe0db42.js";import{_ as B}from"./DeleteModal.vue_vue_type_script_setup_true_lang-4aaa6229.js";import{f as L}from"./index-a84c5b70.js";import{_ as N}from"./PaginationComponent.vue_vue_type_style_index_0_lang-30623594.js";const H={class:"modal-dialog modal-xl",role:"document"},q={class:"modal-content border-0"},F=t("div",{class:"modal-header bg-dark text-white"},[t("h5",{id:"exampleModalLabel",class:"modal-title"},[t("span",null,"訂單細節")]),t("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"modal","aria-label":"Close"})],-1),K={class:"modal-body"},W={class:"row"},X={class:"col-md-4"},z=t("h3",null,"用戶資料",-1),G={class:"table"},J={key:0},Q=t("th",{style:{width:"100px"}},"姓名",-1),Y=t("th",null,"Email",-1),Z=t("th",null,"電話",-1),tt=t("th",null,"地址",-1),et={class:"col-md-8"},st=t("h3",null,"訂單細節",-1),at={class:"table"},ot=t("th",{style:{width:"100px"}},"訂單編號",-1),nt=t("th",null,"下單時間",-1),lt=t("th",null,"付款時間",-1),dt={key:0},it={key:1},ct=t("th",null,"付款狀態",-1),rt={key:0,class:"text-success"},_t={key:1,class:"text-muted"},ut=t("th",null,"總金額",-1),pt=t("h3",null,"選購商品",-1),ht={class:"table"},mt=t("thead",null,[t("tr")],-1),ft={class:"text-end"},yt={class:"d-flex justify-content-end"},bt={class:"form-check"},gt={class:"form-check-label",for:"flexCheckDefault"},kt={key:0},vt={key:1},$t={class:"modal-footer"},wt=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1),Mt=D({__name:"OrderModal",props:{tempOrder:null,isPaid:{type:Boolean}},emits:["update-paid"],setup(O,{expose:m,emit:y}){const o=I(O,"tempOrder"),h=M("");let u;return R(()=>{u=new A(h.value,{keyboard:!1,backdrop:!1})}),m({showModal:()=>u==null?void 0:u.show(),hideModal:()=>u==null?void 0:u.hide()}),(b,r)=>{var c,_;return d(),i("div",{id:"orderModal",ref_key:"orderModalRef",ref:h,class:"modal fade",tabindex:"-1",role:"dialog","aria-labelledby":"orderModalLabel","aria-hidden":"true"},[t("div",H,[t("div",q,[F,t("div",K,[t("div",W,[t("div",X,[z,t("table",G,[n(o).user?(d(),i("tbody",J,[t("tr",null,[Q,t("td",null,l(n(o).user.name),1)]),t("tr",null,[Y,t("td",null,l(n(o).user.email),1)]),t("tr",null,[Z,t("td",null,l(n(o).user.tel),1)]),t("tr",null,[tt,t("td",null,l(n(o).user.address),1)])])):T("",!0)])]),t("div",et,[st,t("table",at,[t("tbody",null,[t("tr",null,[ot,t("td",null,l(n(o).id),1)]),t("tr",null,[nt,t("td",null,l(n(L)(new Date((((c=n(o))==null?void 0:c.create_at)||0)*1e3),"yyyy/MM/dd")),1)]),t("tr",null,[lt,t("td",null,[(_=n(o))!=null&&_.paid_date?(d(),i("span",dt,l(n(L)(n(o).paid_date,"yyyy/MM/dd")),1)):(d(),i("span",it,"時間不正確"))])]),t("tr",null,[ct,t("td",null,[n(o).is_paid?(d(),i("strong",rt,"已付款")):(d(),i("span",_t,"尚未付款"))])]),t("tr",null,[ut,t("td",null,l(n(o).total),1)])])]),pt,t("table",ht,[mt,t("tbody",null,[(d(!0),i(k,null,x(n(o).products,s=>(d(),i("tr",{key:s.id},[t("th",null,l(s.product.title),1),t("td",null,l(s.qty)+" / "+l(s.product.unit),1),t("td",ft,l(s.final_total),1)]))),128))])]),t("div",yt,[t("div",bt,[P(t("input",{id:"flexCheckDefault","onUpdate:modelValue":r[0]||(r[0]=s=>n(o).is_paid=s),class:"form-check-input",type:"checkbox",value:""},null,512),[[U,n(o).is_paid]]),t("label",gt,[n(o).is_paid?(d(),i("span",kt,"已付款")):(d(),i("span",vt,"未付款"))])])])])])]),t("div",$t,[wt,t("button",{type:"button",class:"btn btn-primary",onClick:r[1]||(r[1]=s=>b.$emit("update-paid",n(o)))}," 修改付款狀態 ")])])])],512)}}}),xt={class:"container"},Lt={class:"table mt-4"},Ot=t("thead",null,[t("tr",null,[t("th",{width:"130"},"購買時間"),t("th",{width:"130"},"會員信箱"),t("th",{width:"130"},"購買款項"),t("th",{width:"130"},"總額"),t("th",{width:"130"},"是否付款"),t("th",{width:"120"},"編輯")])],-1),Ct={key:0},Et={class:"text-end"},Vt={class:"form-check form-switch d-flex justify-content-center"},Dt=["id","onUpdate:modelValue","onChange"],Rt=["for"],Tt={key:0},Pt={key:1},Ut={class:"btn-group"},It=["onClick"],At=["onClick"],St={class:"d-flex justify-content-center"},qt=D({__name:"AdminOrdersView",setup(O){const{VITE_URL:m,VITE_PATH:y}={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"tuhacrt",VITE_TOKEN:"loginToken",VITE_TEXT:"Environment is in production build",BASE_URL:"/Hexschool_Vue_Week7/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},e=S({orders:[],tempOrder:{create_at:0,is_paid:!1},pagination:{},isLoading:!1,isPaid:!1,isNew:!1}),o=M(),h=M(),u=async(r=e.pagination.current_page||1)=>{var _;const c=`${m}/api/${y}/admin/orders/?page=${r}`;e.isLoading=!0;try{const s=await $.get(c);e.isLoading=!1,e.orders=s.data.orders,e.pagination=s.data.pagination}catch(s){e.isLoading=!1,s instanceof w&&alert((_=s.response)==null?void 0:_.data.message)}};R(()=>{u()});const v=async r=>{var s,a;const c=`${m}/api/${y}/admin/order/${r.id}`,_={...e.tempOrder,is_paid:r.is_paid,paid_date:r.is_paid?Date.now():0};e.isLoading=!0;try{await $.put(c,{data:_}),(s=o.value)==null||s.hideModal(),u()}catch(f){e.isLoading=!1,f instanceof w&&alert((a=f.response)==null?void 0:a.data.message)}},C=async()=>{var c,_;const r=`${m}/api/${y}/admin/order/${e.tempOrder.id}`;e.isLoading=!0;try{await $.delete(r),(c=h.value)==null||c.hideModal(),u()}catch(s){e.isLoading=!1,s instanceof w&&alert((_=s.response)==null?void 0:_.data.message)}},b=(r,c)=>{var _,s;switch(r){case"edit":e.tempOrder={...c},e.isPaid=e.tempOrder.is_paid,(_=o.value)==null||_.showModal();break;case"delete":e.tempOrder={...c},(s=h.value)==null||s.showModal();break}};return(r,c)=>{var s;const _=j("Loading");return d(),i(k,null,[t("div",xt,[t("table",Lt,[Ot,(s=e.orders)!=null&&s.length?(d(),i("tbody",Ct,[(d(!0),i(k,null,x(e.orders,a=>{var f;return d(),i("tr",{key:a.id},[t("td",null,l(n(L)(new Date(((a==null?void 0:a.create_at)||0)*1e3),"yyyy/MM/dd")),1),t("td",null,l((f=a.user)==null?void 0:f.email),1),t("td",null,[(d(!0),i(k,null,x(a.products,p=>{var E,V;return d(),i("tr",{key:p.id,class:"d-flex justify-content-start"},[t("td",null,l((E=p.product)==null?void 0:E.title)+" "+l(p.qty)+" "+l((V=p.product)==null?void 0:V.unit),1)])}),128))]),t("td",Et,l(a.total),1),t("td",null,[t("div",Vt,[P(t("input",{id:`paidSwitch${a.id}`,"onUpdate:modelValue":p=>a.is_paid=p,type:"checkbox",class:"form-check-input me-2",onChange:p=>v(a)},null,40,Dt),[[U,a.is_paid]]),t("label",{class:"form-check-label",for:`paidSwitch${a.id}`},[a.is_paid?(d(),i("span",Tt,"已付款")):(d(),i("span",Pt,"未付款"))],8,Rt)])]),t("td",null,[t("div",Ut,[t("button",{class:"btn btn-outline-primary btn-sm",onClick:p=>b("edit",a)}," 檢視 ",8,It),t("button",{class:"btn btn-outline-danger btn-sm",onClick:p=>b("delete",a)}," 刪除 ",8,At)])])])}),128))])):T("",!0)]),t("div",St,[g(N,{ref:"paginationComponentRef",pagination:e.pagination,onChangePage:u},null,8,["pagination"])])]),g(Mt,{ref_key:"orderModalRef",ref:o,"temp-order":e.tempOrder,"is-paid":e.tempOrder.is_paid,onUpdatePaid:c[0]||(c[0]=a=>v(e.tempOrder))},null,8,["temp-order","is-paid"]),g(B,{ref_key:"deleteModalRef",ref:h,"delete-item":e.tempOrder,onDeleteItem:C},null,8,["delete-item"]),g(_,{active:e.isLoading,"onUpdate:active":c[1]||(c[1]=a=>e.isLoading=a),"can-cancel":!0,"is-full-page":!0},null,8,["active"])],64)}}});export{qt as default};
